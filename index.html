<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>PRMSU - Student Meeting Scheduler</title>
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">
    
    <!-- SheetJS library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        /* University Header */
        .university-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #667eea;
        }

        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .university-text h1 {
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }

        .university-text h2 {
            font-size: 16px;
            color: #667eea;
            margin-bottom: 5px;
        }

        .university-text p {
            font-size: 12px;
            color: #666;
        }

        /* Login Section */
        .login-container {
            padding: 15px;
        }

        .login-container h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 15px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #2f855a 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
        }

        .admin-link {
            text-align: center;
            margin-top: 15px;
        }

        .admin-link a {
            color: #667eea;
            text-decoration: none;
            font-size: 14px;
        }

        /* Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .dashboard-header h2 {
            font-size: 20px;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .user-info span {
            font-size: 14px;
            color: #666;
        }

        /* Meeting Types */
        .meeting-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .meeting-card {
            padding: 15px 10px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .meeting-card:active {
            transform: scale(0.95);
        }

        .meeting-card.walk-in {
            background: linear-gradient(135deg, #4299e1 0%, #2b6cb0 100%);
            color: white;
        }

        .meeting-card.asynchronous {
            background: linear-gradient(135deg, #48bb78 0%, #2f855a 100%);
            color: white;
        }

        .meeting-card.hybrid {
            background: linear-gradient(135deg, #ed8936 0%, #c05621 100%);
            color: white;
        }

        .meeting-card h3 {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .meeting-card p {
            font-size: 11px;
            opacity: 0.9;
        }

        /* Calendar */
        .calendar-section {
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-header .btn {
            width: auto;
            padding: 8px 12px;
            font-size: 14px;
            margin-bottom: 0;
        }

        .calendar-header h3 {
            font-size: 16px;
            color: #333;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            color: #666;
            padding: 8px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f7fafc;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .calendar-day.available {
            background: #c6f6d5;
            color: #22543d;
            font-weight: 600;
        }

        .calendar-day.available:active {
            transform: scale(0.95);
        }

        .calendar-day.booked {
            background: #fed7d7;
            color: #742a2a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .calendar-day.selected {
            border-color: #667eea;
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .calendar-day.unavailable {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* Time Slots - Updated for mobile */
        .time-slots {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .time-slots h4 {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .time-slot {
            background: white;
            padding: 12px 5px;
            text-align: center;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .time-slot:active {
            transform: scale(0.95);
        }

        .time-slot.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .time-slot.booked {
            background: #fed7d7;
            color: #742a2a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Meetings List */
        .meetings-list {
            margin-top: 25px;
        }

        .meetings-list h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
        }

        .meeting-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid;
        }

        .meeting-item.walk-in {
            border-left-color: #4299e1;
        }

        .meeting-item.asynchronous {
            border-left-color: #48bb78;
        }

        .meeting-item.hybrid {
            border-left-color: #ed8936;
        }

        .meeting-info h4 {
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }

        .meeting-info p {
            font-size: 13px;
            color: #666;
            margin-bottom: 3px;
        }

        .delete-btn {
            background: #fc8181;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .delete-btn:active {
            background: #f56565;
        }

        /* Download Section */
        .download-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        /* Alert */
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }

        .alert.success {
            display: block;
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .alert.error {
            display: block;
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Footer */
        .footer-api {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #666;
        }

        /* Responsive adjustments */
        @media (max-width: 400px) {
            .container {
                padding: 15px;
            }
            
            .meeting-types {
                grid-template-columns: 1fr;
            }
            
            .time-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- University Header -->
        <div class="university-header">
            <div class="logo-container">
                <img src="https://scontent.fcrk1-3.fna.fbcdn.net/v/t39.30808-6/428158663_779337364230080_2416610370381306_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=1d70fc&_nc_ohc=Q7a-8UpAscQQ7kNvwED2XYp&_nc_oc=Adl1QaH27Uo5VaTZPcDSdTGiEiwP8unpe59m4PYkDfiAx8F-368wTRhMwXgy8ShmP30&_nc_zt=23&_nc_ht=scontent.fcrk1-3.fna&_nc_gid=4IXWwsdP6sAetoKN1uCuRQ&oh=00_AftqFqvu7zYD9dHRvvCgXXtsTpZPtkIcSpen-rFYwhEV3Q&oe=69A63832" alt="PRMSU Logo">
            </div>
            <div class="university-text">
                <h1>President Ramon Magsaysay State University</h1>
                <h2>STUDENT MEETING SCHEDULER</h2>
                <p>Iba Zambales, 2201, Philippines</p>
            </div>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <h2>Student Meeting Scheduler</h2>
            <div class="login-form">
                <div class="form-group">
                    <label for="studentId">Student ID</label>
                    <input type="text" id="studentId" placeholder="Enter your Student ID" required>
                </div>
                <div class="form-group">
                    <label for="studentName">Full Name</label>
                    <input type="text" id="studentName" placeholder="Enter your Full Name" required>
                </div>
                <div class="form-group">
                    <label for="department">Department</label>
                    <select id="department" required>
                        <option value="">Select Department</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business">Business</option>
                        <option value="Arts">Arts</option>
                        <option value="Science">Science</option>
                    </select>
                </div>
                <button class="btn" onclick="login()">Login as Student</button>
                <div class="admin-link">
                    <a href="admin.html">üë§ Admin Login</a>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="hidden">
            <div class="dashboard-header">
                <h2>Welcome, <span id="displayName"></span>!</h2>
                <div class="user-info">
                    <span id="displayId"></span>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="alert" id="alertMessage"></div>

            <h3>Select Meeting Type</h3>
            <div class="meeting-types">
                <div class="meeting-card walk-in" onclick="selectMeetingType('walk-in')">
                    <h3>üö∂ Walk-in Meeting</h3>
                    <p>Instant in-person meeting</p>
                </div>
                <div class="meeting-card asynchronous" onclick="selectMeetingType('asynchronous')">
                    <h3>üíª Asynchronous</h3>
                    <p>Flexible timing, online</p>
                </div>
                <div class="meeting-card hybrid" onclick="selectMeetingType('hybrid')">
                    <h3>üîÑ Hybrid Meeting</h3>
                    <p>Mix of in-person & online</p>
                </div>
            </div>

            <!-- Calendar Section -->
            <div id="calendarSection" class="calendar-section hidden">
                <h3 id="selectedMeetingTypeDisplay"></h3>
                <div class="calendar-header">
                    <button class="btn" onclick="previousMonth()">‚Üê</button>
                    <h3 id="currentMonthYear"></h3>
                    <button class="btn" onclick="nextMonth()">‚Üí</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
                
                <div id="timeSlotsSection" class="time-slots hidden">
                    <h4>Select Time for <span id="selectedDate"></span></h4>
                    <div class="time-grid" id="timeSlots"></div>
                </div>

                <button class="btn" onclick="confirmBooking()" id="confirmBookingBtn" style="margin-top: 20px;" disabled>Confirm Schedule</button>
            </div>

            <!-- My Meetings -->
            <div class="meetings-list">
                <h3>My Scheduled Meetings</h3>
                <div id="meetingsList"></div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <button class="btn btn-success" onclick="downloadMeetings('csv')">üì• CSV</button>
                <button class="btn btn-secondary" onclick="downloadMeetings('excel')">üìä Excel</button>
            </div>
        </div>

        <div class="footer-api"><i class="fa fa-envelope"> üìß Email: @Prmsu.edu.ph - President Ramon Magsaysay State University | Main Campus </i></div>
    </div>

    <script>
        // Initialize data structure
        let currentUser = null;
        let selectedMeetingType = null;
        let selectedDate = null;
        let selectedTime = null;
        let currentDate = new Date();
        let availableDates = [];

        // Time slots array with exact times from 7:30 AM to 5:30 PM (no 12:00, 12:30)
        const TIME_SLOTS = [
            '7:30 AM', '8:00 AM', '8:30 AM', '9:00 AM', '9:30 AM', '10:00 AM', '10:30 AM', '11:00 AM', '11:30 AM',
            '1:00 PM', '1:30 PM', '2:00 PM', '2:30 PM', '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM', '5:00 PM', '5:30 PM'
        ];

        // Load data from localStorage
        let meetings = JSON.parse(localStorage.getItem('meetings')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [];

        function login() {
            const studentId = document.getElementById('studentId').value.trim();
            const studentName = document.getElementById('studentName').value.trim();
            const department = document.getElementById('department').value;

            if (!studentId || !studentName || !department) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            // Check if user exists in users database
            const existingUser = users.find(u => u.id === studentId);
            
            if (existingUser) {
                // Case 1: Same ID exists
                if (existingUser.name !== studentName) {
                    showAlert('This Student ID is already registered with a different name. Please use your correct Student ID.', 'error');
                    return;
                }
                
                // Case 2: Same ID and name, but different department
                if (existingUser.department !== department) {
                    if (confirm('This Student ID is registered under a different department. Do you want to update your department?')) {
                        // Update department
                        existingUser.department = department;
                        existingUser.lastLogin = new Date().toISOString();
                        localStorage.setItem('users', JSON.stringify(users));
                        showAlert('Department updated successfully!', 'success');
                    } else {
                        return;
                    }
                } else {
                    // Normal login - update last login
                    existingUser.lastLogin = new Date().toISOString();
                    localStorage.setItem('users', JSON.stringify(users));
                }
            } else {
                // Check if name is already used with a different ID
                const existingName = users.find(u => u.name.toLowerCase() === studentName.toLowerCase());
                if (existingName) {
                    if (!confirm('This name is already registered with a different Student ID. Do you want to continue with this new ID?')) {
                        return;
                    }
                }
                
                // Create new user
                const newUser = {
                    id: studentId,
                    name: studentName,
                    department: department,
                    role: 'student',
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
            }

            // Set current user
            currentUser = {
                id: studentId,
                name: studentName,
                department: department,
                role: 'student',
                loginTime: new Date().toISOString()
            };

            document.getElementById('displayName').textContent = studentName;
            document.getElementById('displayId').textContent = `ID: ${studentId} | Dept: ${department}`;
            
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            displayUserMeetings();
            showAlert('Login successful!', 'success');
            
            // Clear login form
            document.getElementById('studentId').value = '';
            document.getElementById('studentName').value = '';
            document.getElementById('department').value = '';
        }

        function logout() {
            currentUser = null;
            selectedMeetingType = null;
            selectedDate = null;
            selectedTime = null;
            
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            document.getElementById('calendarSection').classList.add('hidden');
            
            showAlert('Logged out successfully!', 'success');
        }

        function selectMeetingType(type) {
            selectedMeetingType = type;
            selectedDate = null;
            selectedTime = null;
            
            let typeDisplay = {
                'walk-in': 'Walk-in Meeting',
                'asynchronous': 'Asynchronous Meeting',
                'hybrid': 'Hybrid Meeting'
            };
            
            document.getElementById('selectedMeetingTypeDisplay').textContent = 
                `Selected: ${typeDisplay[type]}`;
            
            generateAvailableDates();
            document.getElementById('calendarSection').classList.remove('hidden');
            document.getElementById('timeSlotsSection').classList.add('hidden');
            document.getElementById('confirmBookingBtn').disabled = true;
            
            renderCalendar();
        }

        function generateAvailableDates() {
            availableDates = [];
            const today = new Date();
            
            // Generate available dates for next 90 days
            for (let i = 1; i <= 90; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                
                // Available from Monday to Saturday (days 1-6), excluding Sunday (day 0)
                if (date.getDay() >= 1 && date.getDay() <= 6) {
                    availableDates.push(date.toISOString().split('T')[0]);
                }
            }
        }

        function renderCalendar() {
            if (!currentUser) return;
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonthYear').textContent = 
                new Date(year, month).toLocaleDateString('default', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let calendarHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                calendarHTML += `<div class="calendar-day-header">${day}</div>`;
            });
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const date = new Date(year, month, day);
                const dayOfWeek = date.getDay();
                
                // Check if it's a valid day (Monday to Saturday)
                const isValidDay = dayOfWeek >= 1 && dayOfWeek <= 6;
                const isAvailable = isValidDay && availableDates.includes(dateStr);
                const isBooked = meetings.some(m => m.date === dateStr && m.studentId === currentUser.id);
                const isSelected = selectedDate === dateStr;
                
                let classes = 'calendar-day';
                if (dayOfWeek === 0) { // Sunday
                    classes += ' unavailable';
                } else if (isBooked) {
                    classes += ' booked';
                } else if (isSelected) {
                    classes += ' selected';
                } else if (isAvailable) {
                    classes += ' available';
                } else {
                    classes += ' unavailable';
                }
                
                // Only allow clicking on available and not booked days that are Monday-Saturday
                const canSelect = isValidDay && isAvailable && !isBooked;
                
                calendarHTML += `<div class="${classes}" onclick="${canSelect ? `selectDate('${dateStr}')` : ''}">${day}</div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = calendarHTML;
        }

        function selectDate(dateStr) {
            if (!currentUser) return;
            
            selectedDate = dateStr;
            selectedTime = null;
            renderCalendar();
            
            // Show time slots
            document.getElementById('selectedDate').textContent = new Date(dateStr).toLocaleDateString('default', { 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            });
            document.getElementById('timeSlotsSection').classList.remove('hidden');
            document.getElementById('confirmBookingBtn').disabled = true;
            
            generateTimeSlots();
        }

        function generateTimeSlots() {
            if (!currentUser || !selectedDate) return;
            
            let timeSlotsHTML = '';
            
            TIME_SLOTS.forEach(time => {
                const isBooked = meetings.some(m => 
                    m.date === selectedDate && 
                    m.time === time && 
                    m.studentId === currentUser.id
                );
                
                const isSelected = selectedTime === time;
                
                let classes = 'time-slot';
                if (isBooked) classes += ' booked';
                else if (isSelected) classes += ' selected';
                
                timeSlotsHTML += `<div class="${classes}" onclick="selectTime('${time}', ${!isBooked})">${time}</div>`;
            });
            
            document.getElementById('timeSlots').innerHTML = timeSlotsHTML;
        }

        function selectTime(time, isAvailable) {
            if (!isAvailable || !currentUser) return;
            
            selectedTime = time;
            generateTimeSlots();
            document.getElementById('confirmBookingBtn').disabled = false;
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
            document.getElementById('timeSlotsSection').classList.add('hidden');
            selectedDate = null;
            selectedTime = null;
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
            document.getElementById('timeSlotsSection').classList.add('hidden');
            selectedDate = null;
            selectedTime = null;
        }

        function confirmBooking() {
            if (!selectedDate || !selectedTime || !selectedMeetingType || !currentUser) {
                showAlert('Please complete all selections', 'error');
                return;
            }
            
            // Check for duplicate booking
            const existingBooking = meetings.some(m => 
                m.date === selectedDate && 
                m.time === selectedTime && 
                m.studentId === currentUser.id
            );
            
            if (existingBooking) {
                showAlert('You already have a meeting booked at this time', 'error');
                return;
            }
            
            const meeting = {
                id: Date.now(),
                studentId: currentUser.id,
                studentName: currentUser.name,
                department: currentUser.department,
                type: selectedMeetingType,
                date: selectedDate,
                time: selectedTime,
                bookedAt: new Date().toISOString()
            };
            
            meetings.push(meeting);
            localStorage.setItem('meetings', JSON.stringify(meetings));
            
            showAlert('Meeting booked successfully!', 'success');
            
            // Reset selections
            selectedDate = null;
            selectedTime = null;
            document.getElementById('timeSlotsSection').classList.add('hidden');
            document.getElementById('confirmBookingBtn').disabled = true;
            
            // Refresh displays
            renderCalendar();
            displayUserMeetings();
        }

        function displayUserMeetings() {
            if (!currentUser) return;
            
            const userMeetings = meetings.filter(m => m.studentId === currentUser.id);
            
            if (userMeetings.length === 0) {
                document.getElementById('meetingsList').innerHTML = '<p>No meetings scheduled yet.</p>';
                return;
            }
            
            let meetingsHTML = '';
            
            userMeetings.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(meeting => {
                const typeDisplay = {
                    'walk-in': 'üö∂ Walk-in',
                    'asynchronous': 'üíª Asynchronous',
                    'hybrid': 'üîÑ Hybrid'
                };
                
                meetingsHTML += `
                    <div class="meeting-item ${meeting.type}">
                        <div class="meeting-info">
                            <h4>${typeDisplay[meeting.type]}</h4>
                            <p>${new Date(meeting.date).toLocaleDateString()} at ${meeting.time}</p>
                            <p>${meeting.department}</p>
                        </div>
                        <button class="delete-btn" onclick="deleteMeeting(${meeting.id})">Cancel</button>
                    </div>
                `;
            });
            
            document.getElementById('meetingsList').innerHTML = meetingsHTML;
        }

        function deleteMeeting(meetingId) {
            if (!currentUser) return;
            
            if (confirm('Are you sure you want to cancel this meeting?')) {
                meetings = meetings.filter(m => m.id !== meetingId);
                localStorage.setItem('meetings', JSON.stringify(meetings));
                displayUserMeetings();
                renderCalendar();
                showAlert('Meeting cancelled successfully', 'success');
            }
        }

        function downloadMeetings(format) {
            if (!currentUser) {
                showAlert('Please login first', 'error');
                return;
            }
            
            const userMeetings = meetings.filter(m => m.studentId === currentUser.id);
            
            if (userMeetings.length === 0) {
                showAlert('No meetings to download', 'error');
                return;
            }

            // Prepare data for export
            const exportData = userMeetings.map(meeting => ({
                'Meeting ID': meeting.id,
                'Student ID': meeting.studentId,
                'Student Name': meeting.studentName,
                'Department': meeting.department,
                'Meeting Type': meeting.type.charAt(0).toUpperCase() + meeting.type.slice(1),
                'Date': new Date(meeting.date).toLocaleDateString(),
                'Time': meeting.time,
                'Booked At': new Date(meeting.bookedAt).toLocaleString()
            }));

            if (format === 'csv') {
                downloadAsCSV(exportData);
            } else if (format === 'excel') {
                downloadAsExcel(exportData);
            }
        }

        function downloadAsCSV(data) {
            // Define CSV headers
            const headers = ['Meeting ID', 'Student ID', 'Student Name', 'Department', 'Meeting Type', 'Date', 'Time', 'Booked At'];
            
            // Convert data to CSV format
            let csvContent = headers.join(',') + '\n';
            
            data.forEach(row => {
                const rowData = headers.map(header => {
                    const value = row[header];
                    // Handle values that contain commas or quotes
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                });
                csvContent += rowData.join(',') + '\n';
            });

            // Create and trigger download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `meetings_${currentUser.id}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAlert('Meetings downloaded as CSV successfully!', 'success');
        }

        function downloadAsExcel(data) {
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(data);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Meetings');
            
            // Generate Excel file and trigger download
            const fileName = `meetings_${currentUser.id}_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert('Meetings downloaded as Excel successfully!', 'success');
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alertMessage');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            
            setTimeout(() => {
                alert.className = 'alert';
            }, 3000);
        }

        // Also update admin.html to ensure unique student IDs
        function validateUniqueStudent(studentId, studentName) {
            const existingUser = users.find(u => u.id === studentId);
            if (existingUser && existingUser.name !== studentName) {
                return false;
            }
            return true;
        }
    </script>
</body>
</html>