<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Meeting Scheduler - Admin Portal</title>
    <link rel="stylesheet" type="text/css" href="style2.css">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3652/3652191.png">

    <!-- SheetJS library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- University Header -->
        <div class="university-header">
            <div class="logo-container">
                <!-- Using a base64 encoded placeholder for the logo - replace with actual logo -->
                <svg viewBox="0 0 100 100" width="80" height="80">
                    <rect width="200" height="200" fill="#003366"/>
                    <img src="https://scontent.fcrk1-3.fna.fbcdn.net/v/t39.30808-6/428158663_779337364230080_2416610370381306_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=1d70fc&_nc_ohc=Q7a-8UpAscQQ7kNvwED2XYp&_nc_oc=Adl1QaH27Uo5VaTZPcDSdTGiEiwP8unpe59m4PYkDfiAx8F-368wTRhMwXgy8ShmP30&_nc_zt=23&_nc_ht=scontent.fcrk1-3.fna&_nc_gid=4IXWwsdP6sAetoKN1uCuRQ&oh=00_AftqFqvu7zYD9dHRvvCgXXtsTpZPtkIcSpen-rFYwhEV3Q&oe=69A63832">
                </svg>
            </div>
            <div class="university-text">
                <h1>President Ramon Magsaysay State University</h1>
                <h2>STUDENT MEETING SCHEDULER</h2>
                <p>Iba Zambales, 2201, Philippines</p>
            </div>
        </div>
<body>

    <div class="container">
        <!-- Admin Login Section -->
        <div id="loginSection" class="login-container">
            <h2>Admin Portal</h2>
            <div class="login-form">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input type="text" id="adminUsername" placeholder="Enter admin username" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                </div>
                <button class="btn" onclick="adminLogin()">Login</button>
                <button class="btn btn-secondary" onclick="showRegisterModal()">Create New Account</button>
                <div class="student-link">
                    <a href="C:\Users\diazs\OneDrive\Documents\CAS MEETING SCHEDULER\Main\index.html">ðŸ‘¤ Student Login</a>
                </div>
            </div>
        </div>

        <!-- Registration Modal -->
        <div id="registerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Create Admin/Teacher Account</h3>
                    <span class="close-modal" onclick="closeRegisterModal()">&times;</span>
                </div>
                <form id="registerForm" onsubmit="event.preventDefault(); registerAccount();">
                    <div class="form-group">
                        <label for="regFullName">Full Name</label>
                        <input type="text" id="regFullName" placeholder="Enter full name" required>
                    </div>
                    <div class="form-group">
                        <label for="regUsername">Username</label>
                        <input type="text" id="regUsername" placeholder="Choose username" required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">Email Address</label>
                        <input type="email" id="regEmail" placeholder="Enter email address" required>
                    </div>
                    <div class="form-group">
                        <label for="regDepartment">Department</label>
                        <select id="regDepartment" required>
                            <option value="">Select Department</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Business">Business</option>
                            <option value="Arts">Arts</option>
                            <option value="Science">Science</option>
                            <option value="Administration">Administration</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="regPosition">Position/Role</label>
                        <select id="regPosition" required>
                            <option value="">Select Position</option>
                            <option value="teacher">Teacher</option>
                            <option value="admin">Admin</option>
                            <option value="super-admin">Super Admin</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Password</label>
                        <input type="password" id="regPassword" placeholder="Enter password" onkeyup="checkPasswordStrength()" required>
                        <div class="password-strength" id="passwordStrength"></div>
                    </div>
                    <div class="form-group">
                        <label for="regConfirmPassword">Confirm Password</label>
                        <input type="password" id="regConfirmPassword" placeholder="Confirm password" required>
                    </div>
                    <div class="form-group">
                        <label for="regSecurityQuestion">Security Question</label>
                        <select id="regSecurityQuestion" required>
                            <option value="">Select Security Question</option>
                            <option value="pet">What was your first pet's name?</option>
                            <option value="school">What was your first school's name?</option>
                            <option value="mother">What is your mother's maiden name?</option>
                            <option value="city">In which city were you born?</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="regSecurityAnswer">Security Answer</label>
                        <input type="text" id="regSecurityAnswer" placeholder="Enter answer" required>
                    </div>
                    <button type="submit" class="btn btn-success">Create Account</button>
                </form>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="editProfileModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Profile</h3>
                    <span class="close-modal" onclick="closeEditProfileModal()">&times;</span>
                </div>
                <form id="editProfileForm" onsubmit="event.preventDefault(); updateProfile();">
                    <div class="form-group">
                        <label for="editFullName">Full Name</label>
                        <input type="text" id="editFullName" required>
                    </div>
                    <div class="form-group">
                        <label for="editEmail">Email Address</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="editDepartment">Department</label>
                        <select id="editDepartment" required>
                            <option value="">Select Department</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Business">Business</option>
                            <option value="Arts">Arts</option>
                            <option value="Science">Science</option>
                            <option value="Administration">Administration</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-success">Update Profile</button>
                </form>
            </div>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Change Password</h3>
                    <span class="close-modal" onclick="closeChangePasswordModal()">&times;</span>
                </div>
                <form id="changePasswordForm" onsubmit="event.preventDefault(); changePassword();">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" onkeyup="checkNewPasswordStrength()" required>
                        <div class="password-strength" id="newPasswordStrength"></div>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Confirm New Password</label>
                        <input type="password" id="confirmNewPassword" required>
                    </div>
                    <button type="submit" class="btn btn-success">Change Password</button>
                </form>
            </div>
        </div>

        <!-- Admin Dashboard Section -->
        <div id="dashboardSection" class="hidden">
            <div class="dashboard-header">
                <h2>Admin Dashboard</h2>
                <div class="user-info">
                    <span id="displayAdmin"></span>
                    <button class="btn btn-danger" onclick="adminLogout()">Logout</button>
                </div>
            </div>

            <!-- Profile Section -->
            <div class="profile-section" id="profileSection">
                <div class="profile-info">
                    <h3 id="profileName"></h3>
                    <p id="profileEmail"></p>
                    <p id="profileDepartment"></p>
                    <p id="profilePosition"></p>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="showEditProfileModal()">Edit Profile</button>
                    <button class="btn btn-secondary" onclick="showChangePasswordModal()">Change Password</button>
                </div>
            </div>

            <div class="alert" id="alertMessage"></div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Students</h3>
                    <div class="stat-number" id="totalStudents">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Meetings</h3>
                    <div class="stat-number" id="totalMeetings">0</div>
                </div>
                <div class="stat-card">
                    <h3>Today's Meetings</h3>
                    <div class="stat-number" id="todayMeetings">0</div>
                </div>
            </div>

            <!-- Admin Tabs -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="switchTab('meetings')">All Meetings</button>
                <button class="tab-btn" onclick="switchTab('students')">All Students</button>
                <button class="tab-btn" onclick="switchTab('admins')">Admin Accounts</button>
                <button class="tab-btn" onclick="switchTab('reports')">Reports</button>
            </div>

            <!-- Meetings Tab -->
            <div id="meetingsTab" class="tab-content active">
                <div class="search-bar">
                    <input type="text" id="meetingSearch" placeholder="Search meetings by student name, ID, or department..." onkeyup="filterMeetings()">
                </div>
                <div class="table-container" id="meetingsTable"></div>
            </div>

            <!-- Students Tab -->
            <div id="studentsTab" class="tab-content">
                <div class="search-bar">
                    <input type="text" id="studentSearch" placeholder="Search students by name or ID..." onkeyup="filterStudents()">
                </div>
                <div class="table-container" id="studentsTable"></div>
            </div>

            <!-- Admin Accounts Tab -->
            <div id="adminsTab" class="tab-content">
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showRegisterModal()">âž• Create New Admin Account</button>
                </div>
                <div class="search-bar">
                    <input type="text" id="adminSearch" placeholder="Search admin accounts by name, username, or department..." onkeyup="filterAdmins()">
                </div>
                <div class="table-container" id="adminsTable"></div>
            </div>

            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content">
                <h3>Generate Reports</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); cursor: pointer;" onclick="generateReport('daily')">
                        <h3>Daily Report</h3>
                        <p>View meetings for today</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); cursor: pointer;" onclick="generateReport('weekly')">
                        <h3>Weekly Report</h3>
                        <p>View meetings for this week</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); cursor: pointer;" onclick="generateReport('monthly')">
                        <h3>Monthly Report</h3>
                        <p>View meetings for this month</p>
                    </div>
                </div>
                <div id="reportResults" style="margin-top: 20px;"></div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <button class="btn btn-success" onclick="exportAllData('csv')">ðŸ“¥ Export All as CSV</button>
                <button class="btn btn-primary" onclick="exportAllData('excel')">ðŸ“Š Export All as Excel</button>
            </div>
        </div>
    </div>

    <script>
        // Admin credentials storage
        let adminAccounts = JSON.parse(localStorage.getItem('adminAccounts')) || [];
        
        // Initialize default super admin if no accounts exist
        if (adminAccounts.length === 0) {
            const defaultAdmin = {
                id: 'admin_' + Date.now(),
                fullName: 'Super Administrator',
                username: 'admin',
                email: 'admin@system.com',
                department: 'Administration',
                position: 'super-admin',
                password: btoa('admin123'), // Base64 encoded for basic security
                securityQuestion: 'admin',
                securityAnswer: 'admin',
                createdAt: new Date().toISOString(),
                lastLogin: null,
                createdBy: 'system'
            };
            adminAccounts.push(defaultAdmin);
            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
        }

        let currentAdmin = null;
        let meetings = JSON.parse(localStorage.getItem('meetings')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [];
        
        // Sorting state
        let studentSortColumn = 'department';
        let studentSortDirection = 'asc';
        let meetingSortColumn = 'date';
        let meetingSortDirection = 'desc';
        let adminSortColumn = 'department';
        let adminSortDirection = 'asc';

        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();

            if (!username || !password) {
                showAlert('Please enter username and password', 'error');
                return;
            }

            // Find admin account
            const admin = adminAccounts.find(a => a.username === username);
            
            if (admin && atob(admin.password) === password) {
                currentAdmin = admin;
                currentAdmin.lastLogin = new Date().toISOString();
                
                // Update last login
                const index = adminAccounts.findIndex(a => a.username === username);
                adminAccounts[index].lastLogin = currentAdmin.lastLogin;
                localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));

                document.getElementById('displayAdmin').textContent = `${admin.fullName} (${admin.position})`;
                
                // Update profile section
                document.getElementById('profileName').textContent = admin.fullName;
                document.getElementById('profileEmail').textContent = admin.email;
                document.getElementById('profileDepartment').textContent = `Department: ${admin.department}`;
                document.getElementById('profilePosition').textContent = `Position: ${admin.position}`;
                
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                
                updateStats();
                displayAllMeetings();
                displayAllStudents();
                displayAllAdmins();
                showAlert('Admin login successful!', 'success');
                
                // Clear login form
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
            } else {
                showAlert('Invalid admin credentials', 'error');
            }
        }

        function adminLogout() {
            currentAdmin = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
            showAlert('Logged out successfully!', 'success');
        }

        function showRegisterModal() {
            document.getElementById('registerModal').style.display = 'block';
        }

        function closeRegisterModal() {
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('registerForm').reset();
        }

        function showEditProfileModal() {
            if (!currentAdmin) return;
            
            document.getElementById('editFullName').value = currentAdmin.fullName;
            document.getElementById('editEmail').value = currentAdmin.email;
            document.getElementById('editDepartment').value = currentAdmin.department;
            
            document.getElementById('editProfileModal').style.display = 'block';
        }

        function closeEditProfileModal() {
            document.getElementById('editProfileModal').style.display = 'none';
        }

        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'block';
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('changePasswordForm').reset();
        }

        function checkPasswordStrength() {
            const password = document.getElementById('regPassword').value;
            const strengthIndicator = document.getElementById('passwordStrength');
            
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            
            strengthIndicator.className = 'password-strength';
            if (strength <= 2) {
                strengthIndicator.classList.add('strength-weak');
            } else if (strength <= 4) {
                strengthIndicator.classList.add('strength-medium');
            } else {
                strengthIndicator.classList.add('strength-strong');
            }
        }

        function checkNewPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthIndicator = document.getElementById('newPasswordStrength');
            
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/)) strength++;
            if (password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            
            strengthIndicator.className = 'password-strength';
            if (strength <= 2) {
                strengthIndicator.classList.add('strength-weak');
            } else if (strength <= 4) {
                strengthIndicator.classList.add('strength-medium');
            } else {
                strengthIndicator.classList.add('strength-strong');
            }
        }

        function registerAccount() {
            const fullName = document.getElementById('regFullName').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const department = document.getElementById('regDepartment').value;
            const position = document.getElementById('regPosition').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const securityQuestion = document.getElementById('regSecurityQuestion').value;
            const securityAnswer = document.getElementById('regSecurityAnswer').value.trim().toLowerCase();

            // Validation
            if (!fullName || !username || !email || !department || !position || !password || !confirmPassword || !securityQuestion || !securityAnswer) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showAlert('Passwords do not match', 'error');
                return;
            }

            if (password.length < 8) {
                showAlert('Password must be at least 8 characters long', 'error');
                return;
            }

            // Check if username exists
            if (adminAccounts.some(a => a.username === username)) {
                showAlert('Username already exists', 'error');
                return;
            }

            // Check if email exists
            if (adminAccounts.some(a => a.email === email)) {
                showAlert('Email already registered', 'error');
                return;
            }

            const newAdmin = {
                id: 'admin_' + Date.now(),
                fullName: fullName,
                username: username,
                email: email,
                department: department,
                position: position,
                password: btoa(password),
                securityQuestion: securityQuestion,
                securityAnswer: securityAnswer,
                createdAt: new Date().toISOString(),
                lastLogin: null,
                createdBy: currentAdmin ? currentAdmin.username : 'system'
            };

            adminAccounts.push(newAdmin);
            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));

            closeRegisterModal();
            showAlert('Account created successfully!', 'success');
            
            if (currentAdmin) {
                displayAllAdmins();
            }
        }

        function updateProfile() {
            const fullName = document.getElementById('editFullName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const department = document.getElementById('editDepartment').value;

            if (!fullName || !email || !department) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            // Update current admin
            currentAdmin.fullName = fullName;
            currentAdmin.email = email;
            currentAdmin.department = department;

            // Update in adminAccounts
            const index = adminAccounts.findIndex(a => a.id === currentAdmin.id);
            adminAccounts[index] = currentAdmin;
            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));

            // Update display
            document.getElementById('displayAdmin').textContent = `${currentAdmin.fullName} (${currentAdmin.position})`;
            document.getElementById('profileName').textContent = currentAdmin.fullName;
            document.getElementById('profileEmail').textContent = currentAdmin.email;
            document.getElementById('profileDepartment').textContent = `Department: ${currentAdmin.department}`;

            closeEditProfileModal();
            showAlert('Profile updated successfully!', 'success');
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showAlert('Please fill in all fields', 'error');
                return;
            }

            if (atob(currentAdmin.password) !== currentPassword) {
                showAlert('Current password is incorrect', 'error');
                return;
            }

            if (newPassword !== confirmNewPassword) {
                showAlert('New passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 8) {
                showAlert('New password must be at least 8 characters long', 'error');
                return;
            }

            // Update password
            currentAdmin.password = btoa(newPassword);
            
            const index = adminAccounts.findIndex(a => a.id === currentAdmin.id);
            adminAccounts[index] = currentAdmin;
            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));

            closeChangePasswordModal();
            showAlert('Password changed successfully!', 'success');
        }

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function updateStats() {
            document.getElementById('totalStudents').textContent = users.length;
            document.getElementById('totalMeetings').textContent = meetings.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayMeetings = meetings.filter(m => m.date === today).length;
            document.getElementById('todayMeetings').textContent = todayMeetings;
        }

        function getDepartmentBadgeClass(department) {
            const deptMap = {
                'Computer Science': 'cs',
                'Engineering': 'eng',
                'Business': 'bus',
                'Arts': 'art',
                'Science': 'sci',
                'Administration': 'admin'
            };
            return deptMap[department] || '';
        }

        function sortAdmins(admins, column, direction) {
            return admins.sort((a, b) => {
                let aValue = a[column];
                let bValue = b[column];
                
                if (column === 'fullName') {
                    aValue = a.fullName || '';
                    bValue = b.fullName || '';
                } else if (column === 'username') {
                    aValue = a.username || '';
                    bValue = b.username || '';
                } else if (column === 'department') {
                    aValue = a.department || '';
                    bValue = b.department || '';
                } else if (column === 'position') {
                    aValue = a.position || '';
                    bValue = b.position || '';
                } else if (column === 'lastLogin') {
                    aValue = a.lastLogin ? new Date(a.lastLogin) : new Date(0);
                    bValue = b.lastLogin ? new Date(b.lastLogin) : new Date(0);
                }
                
                if (direction === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        function sortAdminsBy(column) {
            if (adminSortColumn === column) {
                adminSortDirection = adminSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                adminSortColumn = column;
                adminSortDirection = 'asc';
            }
            displayAllAdmins();
        }

        function sortStudents(students, column, direction) {
            return students.sort((a, b) => {
                let aValue = a[column];
                let bValue = b[column];
                
                if (column === 'department') {
                    aValue = a.department || '';
                    bValue = b.department || '';
                } else if (column === 'name') {
                    aValue = a.name || '';
                    bValue = b.name || '';
                } else if (column === 'id') {
                    aValue = a.id || '';
                    bValue = b.id || '';
                } else if (column === 'lastLogin') {
                    aValue = a.lastLogin ? new Date(a.lastLogin) : new Date(0);
                    bValue = b.lastLogin ? new Date(b.lastLogin) : new Date(0);
                } else if (column === 'createdAt') {
                    aValue = new Date(a.createdAt || 0);
                    bValue = new Date(b.createdAt || 0);
                }
                
                if (direction === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        function sortMeetings(meetings, column, direction) {
            return meetings.sort((a, b) => {
                let aValue, bValue;
                
                if (column === 'date') {
                    aValue = new Date(a.date + ' ' + a.time);
                    bValue = new Date(b.date + ' ' + b.time);
                } else if (column === 'studentName') {
                    aValue = a.studentName || '';
                    bValue = b.studentName || '';
                } else if (column === 'department') {
                    aValue = a.department || '';
                    bValue = b.department || '';
                } else {
                    aValue = a[column] || '';
                    bValue = b[column] || '';
                }
                
                if (direction === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        function sortStudentsBy(column) {
            if (studentSortColumn === column) {
                studentSortDirection = studentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                studentSortColumn = column;
                studentSortDirection = 'asc';
            }
            displayAllStudents();
        }

        function sortMeetingsBy(column) {
            if (meetingSortColumn === column) {
                meetingSortDirection = meetingSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                meetingSortColumn = column;
                meetingSortDirection = 'asc';
            }
            displayAllMeetings();
        }

        function displayAllMeetings() {
            if (meetings.length === 0) {
                document.getElementById('meetingsTable').innerHTML = '<p style="padding: 20px; text-align: center;">No meetings scheduled yet.</p>';
                return;
            }

            const sortedMeetings = sortMeetings([...meetings], meetingSortColumn, meetingSortDirection);

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="sort-header ${meetingSortColumn === 'id' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('id')">Meeting ID</th>
                            <th class="sort-header ${meetingSortColumn === 'studentId' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('studentId')">Student ID</th>
                            <th class="sort-header ${meetingSortColumn === 'studentName' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('studentName')">Student Name</th>
                            <th class="sort-header ${meetingSortColumn === 'department' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('department')">Department</th>
                            <th>Type</th>
                            <th class="sort-header ${meetingSortColumn === 'date' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('date')">Date</th>
                            <th class="sort-header ${meetingSortColumn === 'time' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('time')">Time</th>
                            <th>Booked At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedMeetings.forEach(meeting => {
                tableHTML += `
                    <tr>
                        <td>${meeting.id}</td>
                        <td>${meeting.studentId}</td>
                        <td>${meeting.studentName}</td>
                        <td><span class="department-badge ${getDepartmentBadgeClass(meeting.department)}">${meeting.department}</span></td>
                        <td><span class="badge ${meeting.type}">${meeting.type}</span></td>
                        <td>${new Date(meeting.date).toLocaleDateString()}</td>
                        <td>${meeting.time}</td>
                        <td>${new Date(meeting.bookedAt).toLocaleString()}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="admin-btn view" onclick="viewMeetingDetails(${meeting.id})">View</button>
                                <button class="admin-btn delete" onclick="adminDeleteMeeting(${meeting.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('meetingsTable').innerHTML = tableHTML;
        }

        function displayAllStudents() {
            if (users.length === 0) {
                document.getElementById('studentsTable').innerHTML = '<p style="padding: 20px; text-align: center;">No students registered yet.</p>';
                return;
            }

            const sortedUsers = sortStudents([...users], studentSortColumn, studentSortDirection);

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="sort-header ${studentSortColumn === 'id' ? studentSortDirection : ''}" onclick="sortStudentsBy('id')">Student ID</th>
                            <th class="sort-header ${studentSortColumn === 'name' ? studentSortDirection : ''}" onclick="sortStudentsBy('name')">Name</th>
                            <th class="sort-header ${studentSortColumn === 'department' ? studentSortDirection : ''}" onclick="sortStudentsBy('department')">Department</th>
                            <th>Role</th>
                            <th class="sort-header ${studentSortColumn === 'createdAt' ? studentSortDirection : ''}" onclick="sortStudentsBy('createdAt')">Registered</th>
                            <th class="sort-header ${studentSortColumn === 'lastLogin' ? studentSortDirection : ''}" onclick="sortStudentsBy('lastLogin')">Last Login</th>
                            <th>Total Meetings</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedUsers.forEach(user => {
                const userMeetings = meetings.filter(m => m.studentId === user.id).length;
                
                tableHTML += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td><span class="department-badge ${getDepartmentBadgeClass(user.department)}">${user.department}</span></td>
                        <td>${user.role || 'student'}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'}</td>
                        <td>${userMeetings}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="admin-btn view" onclick="viewStudentDetails('${user.id}')">View</button>
                                <button class="admin-btn edit" onclick="editStudent('${user.id}')">Edit</button>
                                <button class="admin-btn delete" onclick="adminDeleteStudent('${user.id}')">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('studentsTable').innerHTML = tableHTML;
        }

        function displayAllAdmins() {
            if (adminAccounts.length === 0) {
                document.getElementById('adminsTable').innerHTML = '<p style="padding: 20px; text-align: center;">No admin accounts found.</p>';
                return;
            }

            const sortedAdmins = sortAdmins([...adminAccounts], adminSortColumn, adminSortDirection);

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="sort-header ${adminSortColumn === 'fullName' ? adminSortDirection : ''}" onclick="sortAdminsBy('fullName')">Full Name</th>
                            <th class="sort-header ${adminSortColumn === 'username' ? adminSortDirection : ''}" onclick="sortAdminsBy('username')">Username</th>
                            <th>Email</th>
                            <th class="sort-header ${adminSortColumn === 'department' ? adminSortDirection : ''}" onclick="sortAdminsBy('department')">Department</th>
                            <th class="sort-header ${adminSortColumn === 'position' ? adminSortDirection : ''}" onclick="sortAdminsBy('position')">Position</th>
                            <th class="sort-header ${adminSortColumn === 'lastLogin' ? adminSortDirection : ''}" onclick="sortAdminsBy('lastLogin')">Last Login</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedAdmins.forEach(admin => {
                tableHTML += `
                    <tr>
                        <td>${admin.fullName}</td>
                        <td>${admin.username}</td>
                        <td>${admin.email}</td>
                        <td><span class="department-badge ${getDepartmentBadgeClass(admin.department)}">${admin.department}</span></td>
                        <td><span class="badge ${admin.position}">${admin.position}</span></td>
                        <td>${admin.lastLogin ? new Date(admin.lastLogin).toLocaleString() : 'Never'}</td>
                        <td>${new Date(admin.createdAt).toLocaleDateString()}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="admin-btn view" onclick="viewAdminDetails('${admin.id}')">View</button>
                                <button class="admin-btn edit" onclick="editAdmin('${admin.id}')">Edit</button>
                                <button class="admin-btn password" onclick="resetAdminPassword('${admin.id}')">Reset Password</button>
                                ${admin.id !== currentAdmin?.id ? '<button class="admin-btn delete" onclick="deleteAdmin(\'' + admin.id + '\')">Delete</button>' : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('adminsTable').innerHTML = tableHTML;
        }

        function filterMeetings() {
            const searchTerm = document.getElementById('meetingSearch').value.toLowerCase();
            
            const filteredMeetings = meetings.filter(meeting => 
                meeting.studentName.toLowerCase().includes(searchTerm) ||
                meeting.studentId.toLowerCase().includes(searchTerm) ||
                meeting.department.toLowerCase().includes(searchTerm)
            );

            if (filteredMeetings.length === 0) {
                document.getElementById('meetingsTable').innerHTML = '<p style="padding: 20px; text-align: center;">No meetings found.</p>';
                return;
            }

            const sortedMeetings = sortMeetings(filteredMeetings, meetingSortColumn, meetingSortDirection);

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="sort-header ${meetingSortColumn === 'id' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('id')">Meeting ID</th>
                            <th class="sort-header ${meetingSortColumn === 'studentId' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('studentId')">Student ID</th>
                            <th class="sort-header ${meetingSortColumn === 'studentName' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('studentName')">Student Name</th>
                            <th class="sort-header ${meetingSortColumn === 'department' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('department')">Department</th>
                            <th>Type</th>
                            <th class="sort-header ${meetingSortColumn === 'date' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('date')">Date</th>
                            <th class="sort-header ${meetingSortColumn === 'time' ? meetingSortDirection : ''}" onclick="sortMeetingsBy('time')">Time</th>
                            <th>Booked At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedMeetings.forEach(meeting => {
                tableHTML += `
                    <tr>
                        <td>${meeting.id}</td>
                        <td>${meeting.studentId}</td>
                        <td>${meeting.studentName}</td>
                        <td><span class="department-badge ${getDepartmentBadgeClass(meeting.department)}">${meeting.department}</span></td>
                        <td><span class="badge ${meeting.type}">${meeting.type}</span></td>
                        <td>${new Date(meeting.date).toLocaleDateString()}</td>
                        <td>${meeting.time}</td>
                        <td>${new Date(meeting.bookedAt).toLocaleString()}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="admin-btn view" onclick="viewMeetingDetails(${meeting.id})">View</button>
                                <button class="admin-btn delete" onclick="adminDeleteMeeting(${meeting.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('meetingsTable').innerHTML = tableHTML;
        }

        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            
            const filteredUsers = users.filter(user => 
                user.name.toLowerCase().includes(searchTerm) ||
                user.id.toLowerCase().includes(searchTerm)
            );

            if (filteredUsers.length === 0) {
                document.getElementById('studentsTable').innerHTML = '<p style="padding: 20px; text-align: center;">No students found.</p>';
                return;
            }

            const sortedUsers = sortStudents(filteredUsers, studentSortColumn, studentSortDirection);

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="sort-header ${studentSortColumn === 'id' ? studentSortDirection : ''}" onclick="sortStudentsBy('id')">Student ID</th>
                            <th class="sort-header ${studentSortColumn === 'name' ? studentSortDirection : ''}" onclick="sortStudentsBy('name')">Name</th>
                            <th class="sort-header ${studentSortColumn === 'department' ? studentSortDirection : ''}" onclick="sortStudentsBy('department')">Department</th>
                            <th>Role</th>
                            <th class="sort-header ${studentSortColumn === 'createdAt' ? studentSortDirection : ''}" onclick="sortStudentsBy('createdAt')">Registered</th>
                            <th class="sort-header ${studentSortColumn === 'lastLogin' ? studentSortDirection : ''}" onclick="sortStudentsBy('lastLogin')">Last Login</th>
                            <th>Total Meetings</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedUsers.forEach(user => {
                const userMeetings = meetings.filter(m => m.studentId === user.id).length;
                
                tableHTML += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td><span class="department-badge ${getDepartmentBadgeClass(user.department)}">${user.department}</span></td>
                        <td>${user.role || 'student'}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString()}</td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'}</td>
                        <td>${userMeetings}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="admin-btn view" onclick="viewStudentDetails('${user.id}')">View</button>
                                <button class="admin-btn edit" onclick="editStudent('${user.id}')">Edit</button>
                                <button class="admin-btn delete" onclick="adminDeleteStudent('${user.id}')">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('studentsTable').innerHTML = tableHTML;
        }

        function filterAdmins() {
            const searchTerm = document.getElementById('adminSearch').value.toLowerCase();
            
            const filteredAdmins = adminAccounts.filter(admin => 
                admin.fullName.toLowerCase().includes(searchTerm) ||
                admin.username.toLowerCase().includes(searchTerm) ||
                admin.department.toLowerCase().includes(searchTerm) ||
                admin.position.toLowerCase().includes(searchTerm)
            );

            if (filteredAdmins.length === 0) {
                document.getElementById('adminsTable').innerHTML = '<p style="padding: 20px; text-align: center;">No admin accounts found.</p>';
                return;
            }

            const sortedAdmins = sortAdmins(filteredAdmins, adminSortColumn, adminSortDirection);

            let tableHTML = `
                <table>
                    <thead>
                        <tr>
                            <th class="sort-header ${adminSortColumn === 'fullName' ? adminSortDirection : ''}" onclick="sortAdminsBy('fullName')">Full Name</th>
                            <th class="sort-header ${adminSortColumn === 'username' ? adminSortDirection : ''}" onclick="sortAdminsBy('username')">Username</th>
                            <th>Email</th>
                            <th class="sort-header ${adminSortColumn === 'department' ? adminSortDirection : ''}" onclick="sortAdminsBy('department')">Department</th>
                            <th class="sort-header ${adminSortColumn === 'position' ? adminSortDirection : ''}" onclick="sortAdminsBy('position')">Position</th>
                            <th class="sort-header ${adminSortColumn === 'lastLogin' ? adminSortDirection : ''}" onclick="sortAdminsBy('lastLogin')">Last Login</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedAdmins.forEach(admin => {
                tableHTML += `
                    <tr>
                        <td>${admin.fullName}</td>
                        <td>${admin.username}</td>
                        <td>${admin.email}</td>
                        <td><span class="department-badge ${getDepartmentBadgeClass(admin.department)}">${admin.department}</span></td>
                        <td><span class="badge ${admin.position}">${admin.position}</span></td>
                        <td>${admin.lastLogin ? new Date(admin.lastLogin).toLocaleString() : 'Never'}</td>
                        <td>${new Date(admin.createdAt).toLocaleDateString()}</td>
                        <td>
                            <div class="admin-actions">
                                <button class="admin-btn view" onclick="viewAdminDetails('${admin.id}')">View</button>
                                <button class="admin-btn edit" onclick="editAdmin('${admin.id}')">Edit</button>
                                <button class="admin-btn password" onclick="resetAdminPassword('${admin.id}')">Reset Password</button>
                                ${admin.id !== currentAdmin?.id ? '<button class="admin-btn delete" onclick="deleteAdmin(\'' + admin.id + '\')">Delete</button>' : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('adminsTable').innerHTML = tableHTML;
        }

        function viewMeetingDetails(meetingId) {
            const meeting = meetings.find(m => m.id === meetingId);
            if (meeting) {
                alert(`
Meeting Details:
----------------
ID: ${meeting.id}
Student: ${meeting.studentName} (${meeting.studentId})
Department: ${meeting.department}
Type: ${meeting.type}
Date: ${new Date(meeting.date).toLocaleDateString()}
Time: ${meeting.time}
Booked: ${new Date(meeting.bookedAt).toLocaleString()}
                `);
            }
        }

        function viewStudentDetails(studentId) {
            const user = users.find(u => u.id === studentId);
            const userMeetings = meetings.filter(m => m.studentId === studentId);
            
            if (user) {
                let meetingsList = userMeetings.map(m => 
                    `  - ${new Date(m.date).toLocaleDateString()} at ${m.time} (${m.type})`
                ).join('\n');

                alert(`
Student Details:
----------------
ID: ${user.id}
Name: ${user.name}
Department: ${user.department}
Role: ${user.role || 'student'}
Registered: ${new Date(user.createdAt).toLocaleDateString()}
Last Login: ${user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'}
Total Meetings: ${userMeetings.length}

Meetings:
${meetingsList || '  No meetings scheduled'}
                `);
            }
        }

        function viewAdminDetails(adminId) {
            const admin = adminAccounts.find(a => a.id === adminId);
            if (admin) {
                alert(`
Admin Details:
--------------
Full Name: ${admin.fullName}
Username: ${admin.username}
Email: ${admin.email}
Department: ${admin.department}
Position: ${admin.position}
Created: ${new Date(admin.createdAt).toLocaleString()}
Last Login: ${admin.lastLogin ? new Date(admin.lastLogin).toLocaleString() : 'Never'}
Created By: ${admin.createdBy}
                `);
            }
        }

        function editAdmin(adminId) {
            const admin = adminAccounts.find(a => a.id === adminId);
            if (!admin) return;

            const newName = prompt('Enter new full name:', admin.fullName);
            if (newName && newName.trim()) {
                admin.fullName = newName.trim();
            }

            const newEmail = prompt('Enter new email:', admin.email);
            if (newEmail && newEmail.trim()) {
                admin.email = newEmail.trim();
            }

            const newDepartment = prompt('Enter new department (Computer Science, Engineering, Business, Arts, Science, Administration):', admin.department);
            if (newDepartment && newDepartment.trim()) {
                admin.department = newDepartment.trim();
            }

            const newPosition = prompt('Enter new position (teacher, admin, super-admin):', admin.position);
            if (newPosition && ['teacher', 'admin', 'super-admin'].includes(newPosition)) {
                admin.position = newPosition;
            }

            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
            displayAllAdmins();
            showAlert('Admin account updated successfully', 'success');
        }

        function resetAdminPassword(adminId) {
            if (!confirm('Are you sure you want to reset this admin\'s password?')) return;

            const admin = adminAccounts.find(a => a.id === adminId);
            if (admin) {
                const newPassword = prompt('Enter new password (min 8 characters):', '');
                if (newPassword && newPassword.length >= 8) {
                    admin.password = btoa(newPassword);
                    localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
                    showAlert('Password reset successfully', 'success');
                } else {
                    showAlert('Password must be at least 8 characters', 'error');
                }
            }
        }

        function deleteAdmin(adminId) {
            if (!confirm('Are you sure you want to delete this admin account? This action cannot be undone.')) return;

            adminAccounts = adminAccounts.filter(a => a.id !== adminId);
            localStorage.setItem('adminAccounts', JSON.stringify(adminAccounts));
            displayAllAdmins();
            showAlert('Admin account deleted successfully', 'success');
        }

        function editStudent(studentId) {
            const user = users.find(u => u.id === studentId);
            if (user) {
                const newName = prompt('Enter new name:', user.name);
                if (newName && newName.trim()) {
                    user.name = newName.trim();
                    localStorage.setItem('users', JSON.stringify(users));
                    displayAllStudents();
                    showAlert('Student updated successfully', 'success');
                }
            }
        }

        function adminDeleteMeeting(meetingId) {
            if (confirm('Are you sure you want to delete this meeting?')) {
                meetings = meetings.filter(m => m.id !== meetingId);
                localStorage.setItem('meetings', JSON.stringify(meetings));
                updateStats();
                displayAllMeetings();
                showAlert('Meeting deleted successfully', 'success');
            }
        }

        function adminDeleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student? All their meetings will also be deleted.')) {
                meetings = meetings.filter(m => m.studentId !== studentId);
                users = users.filter(u => u.id !== studentId);
                
                localStorage.setItem('meetings', JSON.stringify(meetings));
                localStorage.setItem('users', JSON.stringify(users));
                
                updateStats();
                displayAllStudents();
                displayAllMeetings();
                showAlert('Student deleted successfully', 'success');
            }
        }

        function generateReport(period) {
            const today = new Date();
            let filteredMeetings = [];
            let periodText = '';

            switch(period) {
                case 'daily':
                    const todayStr = today.toISOString().split('T')[0];
                    filteredMeetings = meetings.filter(m => m.date === todayStr);
                    periodText = 'Daily Report - ' + today.toLocaleDateString();
                    break;
                case 'weekly':
                    const weekAgo = new Date(today);
                    weekAgo.setDate(today.getDate() - 7);
                    filteredMeetings = meetings.filter(m => new Date(m.date) >= weekAgo);
                    periodText = 'Weekly Report - Last 7 Days';
                    break;
                case 'monthly':
                    const monthAgo = new Date(today);
                    monthAgo.setMonth(today.getMonth() - 1);
                    filteredMeetings = meetings.filter(m => new Date(m.date) >= monthAgo);
                    periodText = 'Monthly Report - Last 30 Days';
                    break;
            }

            if (filteredMeetings.length === 0) {
                document.getElementById('reportResults').innerHTML = '<p style="padding: 20px; text-align: center;">No meetings found for this period.</p>';
                return;
            }

            const meetingsByDept = {};
            filteredMeetings.forEach(meeting => {
                if (!meetingsByDept[meeting.department]) {
                    meetingsByDept[meeting.department] = [];
                }
                meetingsByDept[meeting.department].push(meeting);
            });

            let reportHTML = `
                <h4 style="margin: 20px 0;">${periodText}</h4>
                <p><strong>Total Meetings: ${filteredMeetings.length}</strong></p>
            `;

            Object.keys(meetingsByDept).sort().forEach(dept => {
                reportHTML += `
                    <h5 style="margin: 15px 0 10px 0; color: #555;">${dept} (${meetingsByDept[dept].length} meetings)</h5>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Student ID</th>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                meetingsByDept[dept].forEach(meeting => {
                    reportHTML += `
                        <tr>
                            <td>${meeting.studentName}</td>
                            <td>${meeting.studentId}</td>
                            <td><span class="badge ${meeting.type}">${meeting.type}</span></td>
                            <td>${new Date(meeting.date).toLocaleDateString()}</td>
                            <td>${meeting.time}</td>
                        </tr>
                    `;
                });

                reportHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            });

            document.getElementById('reportResults').innerHTML = reportHTML;
        }

        function exportAllData(format) {
            if (!currentAdmin) return;

            const exportData = {
                meetings: meetings,
                users: users,
                admins: adminAccounts,
                exportDate: new Date().toISOString(),
                totalMeetings: meetings.length,
                totalUsers: users.length,
                totalAdmins: adminAccounts.length
            };

            if (format === 'csv') {
                exportAllAsCSV(exportData);
            } else if (format === 'excel') {
                exportAllAsExcel(exportData);
            }
        }

        function exportAllAsCSV(data) {
            // Prepare meetings CSV
            const meetingsHeaders = ['Meeting ID', 'Student ID', 'Student Name', 'Department', 'Meeting Type', 'Date', 'Time', 'Booked At'];
            let meetingsCSV = 'MEETINGS DATA\n' + meetingsHeaders.join(',') + '\n';
            
            data.meetings.forEach(meeting => {
                const row = [
                    meeting.id,
                    meeting.studentId,
                    meeting.studentName,
                    meeting.department,
                    meeting.type,
                    new Date(meeting.date).toLocaleDateString(),
                    meeting.time,
                    new Date(meeting.bookedAt).toLocaleString()
                ];
                meetingsCSV += row.join(',') + '\n';
            });

            // Prepare users CSV
            const sortedUsers = sortStudents([...data.users], 'department', 'asc');
            const usersHeaders = ['Student ID', 'Name', 'Department', 'Role', 'Created At', 'Last Login'];
            let usersCSV = '\n\nSTUDENTS DATA (Sorted by Department)\n' + usersHeaders.join(',') + '\n';
            
            sortedUsers.forEach(user => {
                const row = [
                    user.id,
                    user.name,
                    user.department,
                    user.role || 'student',
                    new Date(user.createdAt).toLocaleString(),
                    user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never'
                ];
                usersCSV += row.join(',') + '\n';
            });

            // Prepare admins CSV
            const sortedAdmins = sortAdmins([...data.admins], 'department', 'asc');
            const adminsHeaders = ['Full Name', 'Username', 'Email', 'Department', 'Position', 'Created At', 'Last Login'];
            let adminsCSV = '\n\nADMIN ACCOUNTS DATA\n' + adminsHeaders.join(',') + '\n';
            
            sortedAdmins.forEach(admin => {
                const row = [
                    admin.fullName,
                    admin.username,
                    admin.email,
                    admin.department,
                    admin.position,
                    new Date(admin.createdAt).toLocaleString(),
                    admin.lastLogin ? new Date(admin.lastLogin).toLocaleString() : 'Never'
                ];
                adminsCSV += row.join(',') + '\n';
            });

            const blob = new Blob([meetingsCSV + usersCSV + adminsCSV], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `admin_export_${new Date().toISOString().split('T')[0]}.csv`);
            link.click();
            
            showAlert('All data exported as CSV successfully!', 'success');
        }

        function exportAllAsExcel(data) {
            const wb = XLSX.utils.book_new();

            // Meetings worksheet
            const meetingsWS = XLSX.utils.json_to_sheet(data.meetings.map(m => ({
                'Meeting ID': m.id,
                'Student ID': m.studentId,
                'Student Name': m.studentName,
                'Department': m.department,
                'Meeting Type': m.type,
                'Date': new Date(m.date).toLocaleDateString(),
                'Time': m.time,
                'Booked At': new Date(m.bookedAt).toLocaleString()
            })));
            XLSX.utils.book_append_sheet(wb, meetingsWS, 'Meetings');

            // Users worksheet
            const sortedUsers = sortStudents([...data.users], 'department', 'asc');
            const usersWS = XLSX.utils.json_to_sheet(sortedUsers.map(u => ({
                'Student ID': u.id,
                'Name': u.name,
                'Department': u.department,
                'Role': u.role || 'student',
                'Created At': new Date(u.createdAt).toLocaleString(),
                'Last Login': u.lastLogin ? new Date(u.lastLogin).toLocaleString() : 'Never',
                'Total Meetings': meetings.filter(m => m.studentId === u.id).length
            })));
            XLSX.utils.book_append_sheet(wb, usersWS, 'Students');

            // Admins worksheet
            const sortedAdmins = sortAdmins([...data.admins], 'department', 'asc');
            const adminsWS = XLSX.utils.json_to_sheet(sortedAdmins.map(a => ({
                'Full Name': a.fullName,
                'Username': a.username,
                'Email': a.email,
                'Department': a.department,
                'Position': a.position,
                'Created At': new Date(a.createdAt).toLocaleString(),
                'Last Login': a.lastLogin ? new Date(a.lastLogin).toLocaleString() : 'Never'
            })));
            XLSX.utils.book_append_sheet(wb, adminsWS, 'Admins');

            // Summary worksheet
            const summaryData = [{
                'Metric': 'Total Students',
                'Value': data.totalUsers
            }, {
                'Metric': 'Total Meetings',
                'Value': data.totalMeetings
            }, {
                'Metric': 'Total Admins',
                'Value': data.totalAdmins
            }, {
                'Metric': 'Export Date',
                'Value': new Date(data.exportDate).toLocaleString()
            }];
            const summaryWS = XLSX.utils.json_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWS, 'Summary');

            const fileName = `admin_export_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showAlert('All data exported as Excel successfully!', 'success');
        }

        function showAlert(message, type) {
            const alert = document.getElementById('alertMessage');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            
            setTimeout(() => {
                alert.className = 'alert';
            }, 3000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const registerModal = document.getElementById('registerModal');
            const editProfileModal = document.getElementById('editProfileModal');
            const changePasswordModal = document.getElementById('changePasswordModal');
            
            if (event.target === registerModal) {
                closeRegisterModal();
            }
            if (event.target === editProfileModal) {
                closeEditProfileModal();
            }
            if (event.target === changePasswordModal) {
                closeChangePasswordModal();
            }
        }
    </script>
    <div class="footer-api"><i class="fa fa-envelope"> ðŸ“§ Email: @Prmsu.edu.ph - President Ramon Magsaysay State University | Main Campus </i></div>
</body>

</html>
